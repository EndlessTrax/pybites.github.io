<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="In my earlier post on sending basic emails with Python smtplib I outlined the bare minimum required to send an email with Python. While functional, it does however lack more advanced features...">
        <meta name="keywords" content="automation, code, email, MIME, pybites, python, tips, tricks">
        <link rel="icon" href="https://pybit.es/favicon.ico">

        <title>Send Advanced Emails with Python MIME Submodules - PyBites</title>

        <!-- Stylesheets -->
        <link href="https://pybit.es/theme/css/all.min.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <link href="https://pybit.es/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="PyBites Full Atom Feed" />
        <link href="https://pybit.es/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="PyBites Full RSS Feed" />
        <link href="https://pybit.es/feeds/tools.rss.xml" type="application/rss+xml" rel="alternate" title="PyBites Categories RSS Feed" />
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

          <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5859c6a67eb6254d" async="async"></script>

        <!-- Google Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-89294245-1', 'auto');
          ga('send', 'pageview');
        </script>
        <!-- /Google Analytics -->



    <!-- mailchimp subscribe -->
    <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/unique-methods/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">window.dojoRequire(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us14.list-manage.com","uuid":"822043293f280259d4b8d2a3e","lid":"ac7e2eb9ef","uniqueMethods":true}) })</script>
    <!-- end mailchimp subscribe -->

    <!-- Facebook Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '204929054292880');
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=204929054292880&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Facebook Pixel Code -->

    </head>

    <body>

        <!-- Header -->
    <div class="header-container gradient">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="https://pybit.es/"><img class="mr20" src="https://pybit.es/images/logo.png" alt="logo"></a>
                    </div>
                    <div class="nav pull-right">
                                <a  href="https://pybit.es/">Home</a>
                                <a  href="https://pybit.es/archives.html">Blog</a>
                                <a href="https://codechalleng.es" target="_blank">Platform</a>
                                <a href="http://pybites.mykajabi.com" target="_blank">Members</a>
                                <a  style="background-color: #ba9926!important; border-radius: 5px;" href="https://pybit.es/pages/apply.html">Apply</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">Send Advanced Emails with Python MIME Submodules</h1>
                      <p class="header-date"> <a href="https://pybit.es/author/julian.html">Julian</a>, Wed 01 February 2017,  <a href="https://pybit.es/category/tools.html">Tools</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="https://pybit.es/tag/automation.html">automation</a>, <a href="https://pybit.es/tag/code.html">code</a>, <a href="https://pybit.es/tag/email.html">email</a>, <a href="https://pybit.es/tag/mime.html">MIME</a>, <a href="https://pybit.es/tag/pybites.html">pybites</a>, <a href="https://pybit.es/tag/python.html">python</a>, <a href="https://pybit.es/tag/tips.html">tips</a>, <a href="https://pybit.es/tag/tricks.html">tricks</a>                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>In my earlier post on <a href="http://pybit.es/python-smtplib.html">sending basic emails with Python smtplib</a> I outlined the bare minimum required to send an email with Python.</p>
<p>While functional, it does however lack more advanced features which I'll touch on in this post. We'll be using the MIME email submodules to create a richer email.</p>
<h2>What is MIME?</h2>
<p>For those who are unaware, MIME (Multipurpose Internet Mail Extensions) is a standard that essentially makes emails more functional. As per the <a href="https://en.wikipedia.org/wiki/MIME">Wikipedia Article</a>:</p>
<blockquote>
<p>Multipurpose Internet Mail Extensions (MIME) is an Internet standard that extends the format of email to support:
- Text in character sets other than ASCII
- Non-text attachments: audio, video, images, application programs etc.
- Message bodies with multiple parts
- Header information in non-ASCII character sets</p>
</blockquote>
<h2>The Setup</h2>
<p>You'll need to import <em>smtplib</em> as expected but also the MIME submodules "MIMEMultipart" and "MIMEText":</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">smtplib</span>
<span class="kn">from</span> <span class="nn">email.mime.multipart</span> <span class="kn">import</span> <span class="n">MIMEMultipart</span>
<span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
</pre></div>


<h2>Data Entry</h2>
<p>Next we'll add the missing header detail to the email. I aimed to make this as Pythonic as possible:</p>
<div class="highlight"><pre><span></span>from_addr = &#39;pybitesblog@gmail.com&#39;
to_addr = [&#39;bob@rocks.com&#39;, &#39;julian_is@awesome.com&#39;]
msg = MIMEMultipart()
msg[&#39;From&#39;] = from_addr
msg[&#39;To&#39;] = &quot;, &quot;.join(to_addr)
msg[&#39;Subject&#39;] = &#39;Test Automation Email&#39;
</pre></div>


<p>Breaking that down line by line:</p>
<ol>
<li>
<p>Assign your from/sender email address to a variable.</p>
</li>
<li>
<p>Assin your recipient address or addresses to a variable.</p>
</li>
<li>
<p>Assign the MIMEMultipart function to variable.</p>
</li>
<li>
<p>Assign your sender email address variable to the 'From' value in MIME.</p>
</li>
<li>
<p>Assign your recipient addresses to the 'To' value in MIME. Note the .join function is used here to concatenate the email addresses with a comma.</p>
</li>
<li>
<p>Specify your Subject Line and add it to MIME.</p>
</li>
</ol>
<p>Now for the meat. Add the text for the body of your email and again add it to MIME:</p>
<div class="highlight"><pre><span></span>body = &quot;Hello Everyone!&quot;

msg.attach(MIMEText(body, &#39;plain&#39;))
</pre></div>


<p>I've added the data in the body variable to MIMEText in plain text format. You can specify HTML if you wish.</p>
<h2>Send the Email</h2>
<p>I'll be reusing the code from the simple email article here with a small addition. First the standard code:</p>
<div class="highlight"><pre><span></span>smtp_server = smtplib.SMTP(&#39;smtp.gmail.com&#39;, 587) #Specify Gmail Mail server

smtp_server.ehlo() #Send mandatory &#39;hello&#39; message to SMTP server

smtp_server.starttls() #Start TLS Encryption as we&#39;re not using SSL.

#Login to gmail: Account | Password
smtp_server.login(&#39; pybitesblog@gmail.com &#39;, &#39; GMAIL APPLICATION PASSWORD &#39;)
</pre></div>


<p>The additional code is in the sendmail function. We now need to specify the text that we're sending. That is, we take all of the data that was added to the MIMEMultipart function (<em>msg</em> variable) and we use it to populate the email:</p>
<div class="highlight"><pre><span></span>text = msg.as_string()

#Compile email: From, To, Email body
smtp_server.sendmail(from_addr, to_addr, text)
</pre></div>


<p>And finally, best practice, we close off the SMTP connection and in this case, print a message to indicate the email was sent:</p>
<div class="highlight"><pre><span></span>smtp_server.quit()
print(&#39;Email sent successfully&#39;)
</pre></div>


<h2>Conclusion</h2>
<p>Using this framework you can start to send more and more detailed emails. MIME allows you to send attachments which opens all sorts of doors.</p>
<p>Check out the <a href="https://docs.python.org/3/library/email-examples.html">Python 3 Docs on Email</a> to see some other detailed examples. I like the idea of the HTML message with an alternative plain text version. Very cool!</p>
<p>Keep Calm and Code in Python!</p>
<p>-- Julian</p>


    <div class="comments">
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'http-pybit-es';
                var disqus_identifier = 'python-MIME.html';
                var disqus_url = 'https://pybit.es/python-MIME.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
        <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>
        
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="https://pybit.es/pages/guests.html">Authors</a></li>
                            <li><a href="https://pybit.es/pages/community.html">Community</a></li>
                            <li><a href="https://pybit.es/pages/100days.html">100 Days Of Code</a></li>
                            <li><a href="https://pybit.es/pages/search.html">Search</a></li>
                            <li><a href="https://pybit.es/pages/privacy-policy.html">Privacy Policy</a></li>
                            <li><a href="https://pybit.es/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">Atom Feed</a></li>
                            <li><a href="https://pybit.es/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">RSS Feed</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Reach Out</div>
                        <ul class="list-unstyled">
                            <li><a href="mailto:info@pybit.es" target="_blank">Email</a></li>
                            <li><a href="https://twitter.com/pybites" target="_blank">Twitter</a></li>
                            <li><a href="https://facebook.com/pybites" target="_blank">Facebook</a></li>
                            <li><a href="https://github.com/pybites" target="_blank">Github</a></li>
                            <li><a href="https://github.com/PyBites-Open-Source" target="_blank">Open Source</a></li>
                            <li><a href="https://www.youtube.com/channel/UCBn-uKDGsRBfcB0lQeOB_gA" target="_blank">YouTube</a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; PyBites 2016+</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>